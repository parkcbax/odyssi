// This schema file is the source of truth for your database.
// Learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified DateTime?
  image         String?
  passwordHash  String?
  timezone      String    @default("UTC")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  journals Journal[]
  tags     Tag[]
  posts    BlogPost[]
}

model Journal {
  id          String   @id @default(cuid())
  title       String
  description String?
  color       String   @default("#718982") // Default to Sage Green
  icon        String?  // Emoji or icon name
  coverImage  String?
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  entries     Entry[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Entry {
  id           String   @id @default(cuid())
  title        String
  content      Json? // Tiptap JSON content
  date         DateTime // The date of the entry (user selected)
  locationLat  Float?
  locationLng  Float?
  locationName String?
  mood         String? // Emoji or mood name

  isPublic       Boolean   @default(false)
  publicSlug     String?   @unique
  publicPassword String?
  publicExpiresAt DateTime?

  journalId String
  journal   Journal @relation(fields: [journalId], references: [id], onDelete: Cascade)

  images Asset[]
  tags   Tag[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Asset {
  id        String   @id @default(cuid())
  url       String
  type      String   @default("image")
  entryId   String
  entry     Entry    @relation(fields: [entryId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}

model Tag {
  id      String  @id @default(cuid())
  name    String
  userId  String
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  entries Entry[]

  @@unique([name, userId])
}

model BlogPost {
  id        String   @id @default(cuid())
  title     String
  slug      String   @unique
  category  String?
  content       Json?
  excerpt       String?
  featuredImage String?
  keywords      String?  // Comma separated keywords
  published     Boolean  @default(false)
  
  authorId  String
  author    User     @relation(fields: [authorId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model AppConfig {
  id                  String  @id @default(cuid())
  redirectHomeToLogin Boolean @default(false)
  enableBlogging      Boolean @default(false)
  
  // Auto Backup Settings
  enableAutoBackup    Boolean @default(false)
  autoBackupInterval  String  @default("1Week") // 1Week, 1Month, 6Month, 1Year
  lastAutoBackupAt    DateTime?
}
